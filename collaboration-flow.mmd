sequenceDiagram
    participant U1 as User 1 (Developer A)
    participant U2 as User 2 (Developer B)
    participant WS as WebSocket Server
    participant AI as AI Assistant
    participant DB as Code Database
    participant LLM as Language Model

    Note over U1, LLM: Real-time Collaborative Coding Session

    U1->>WS: Connect to session
    WS->>U1: Session joined successfully
    
    U2->>WS: Connect to same session
    WS->>U2: Session joined successfully
    WS->>U1: User 2 joined session

    U1->>WS: Type code: "def calculate_sum(a, b):"
    WS->>U2: Broadcast code change
    WS->>DB: Save code state

    U2->>WS: Add code: "return a + b"
    WS->>U1: Broadcast code change
    WS->>DB: Save code state

    U1->>AI: Request code review
    AI->>LLM: Analyze code for issues
    LLM->>AI: Return analysis results
    AI->>WS: Send review feedback
    WS->>U1: Display review results
    WS->>U2: Display review results

    U2->>AI: Generate unit tests
    AI->>LLM: Generate test cases
    LLM->>AI: Return test code
    AI->>WS: Send generated tests
    WS->>U1: Display generated tests
    WS->>U2: Display generated tests

    U1->>WS: Accept AI suggestions
    WS->>U2: Broadcast accepted changes
    WS->>DB: Save final code state

    Note over U1, LLM: Session ends with synchronized code
